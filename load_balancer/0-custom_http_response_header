#!/usr/bin/env bash
# Configures Nginx to add a custom HTTP header X-Served-By with the server hostname

set -euo pipefail

# Update package lists and install Nginx if not installed
if ! command -v nginx > /dev/null; then
    apt-get update -y
    apt-get install -y nginx
fi

hostnamectl set-hostname 6661-web-01
hostnamectl set-hostname 6661-web-02

# Create custom nginx config to add header globally
cat > /etc/nginx/conf.d/custom_header.conf << EOF
add_header X-Served-By \$hostname;
EOF

# Test Nginx config for syntax errors
nginx -t

# Reload Nginx service to apply new configuration
systemctl reload nginx
